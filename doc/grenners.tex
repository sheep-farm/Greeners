\documentclass[a4paper,11pt]{article}

% --- Pacotes e Configurações ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb, amsfonts, mathtools}
\usepackage{geometry}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{bm} % Para negrito matemático

% Layout
\geometry{top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm}
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.8em}

% Estilização dos Títulos
\titleformat{\section}{\Large\bfseries\uppercase}{}{0em}{}[\hrule]
\titleformat{\subsection}{\large\bfseries}{}{0em}{}

% Definições Matemáticas
\newcommand{\betahat}{\hat{\bm{\beta}}}
\newcommand{\X}{\bm{X}}
\newcommand{\y}{\bm{y}}
\newcommand{\Z}{\bm{Z}}
\newcommand{\epshat}{\hat{\bm{\epsilon}}}
\newcommand{\Var}{\text{Var}}

% Configuração de Cores para Código Rust
\definecolor{rustkeyword}{rgb}{0.4, 0.1, 0.4}
\definecolor{rusttype}{rgb}{0.0, 0.3, 0.6}
\definecolor{rustcomment}{rgb}{0.5, 0.5, 0.5}
\definecolor{bg}{rgb}{0.97, 0.97, 0.97}

\lstdefinelanguage{Rust}{
    keywords={fn, let, mut, if, else, match, use, pub, struct, impl, enum, type},
    keywordstyle=\color{rustkeyword}\bfseries,
    ndkeywords={f64, usize, Array1, Array2, Result, Option, CovarianceType, OLS, IV, GMM, Logit, Probit, DiffInDiff, TimeSeries},
    ndkeywordstyle=\color{rusttype}\bfseries,
    comment=[l]{//},
    commentstyle=\color{rustcomment}\itshape,
    backgroundcolor=\color{bg},
    basicstyle=\ttfamily\small,
    breaklines=true,
    frame=leftline,
    framesep=5pt,
    tabsize=4,
    showstringspaces=false
}

% --- Cabeçalho ---
\title{\textbf{GREENERS: ECONOMETRIC REFERENCE MANUAL}}
\author{Flávio de Vasconcellos Corrêa}
\date{v0.1.0}

\begin{document}

\maketitle

\section{1. Linear Models \& Robust Inference}

\subsection{Ordinary Least Squares (OLS)}
The point estimator is the standard projection of $y$ onto the column space of $X$:
$$ \betahat_{OLS} = (\X'\X)^{-1}\X'\y $$

\subsubsection{Variance-Covariance Estimation}
Greeners implements three types of variance estimators $\widehat{\Var}(\betahat) = (\X'\X)^{-1} \hat{\Omega} (\X'\X)^{-1}$.

\begin{itemize}
    \item \textbf{Homoskedastic (Standard):} Assumes $E[\epsilon \epsilon'] = \sigma^2 I$.
    $$ \hat{\Omega} = \hat{\sigma}^2 (\X'\X) $$
    
    \item \textbf{White's Robust (HC1):} Consistent under arbitrary heteroskedasticity.
    $$ \hat{\Omega}_{HC1} = \sum_{i=1}^n \hat{\epsilon}_i^2 \bm{x}_i \bm{x}_i' $$
    
    \item \textbf{Newey-West (HAC):} Consistent under heteroskedasticity and autocorrelation up to lag $L$. Uses the Bartlett Kernel to ensure positive semi-definiteness.
    $$ \hat{\Omega}_{HAC} = \hat{\Omega}_0 + \sum_{l=1}^L w_l (\hat{\Omega}_l + \hat{\Omega}_l') \quad \text{where} \quad w_l = 1 - \frac{l}{L+1} $$
\end{itemize}

\textbf{Rust Implementation:}
\begin{lstlisting}[language=Rust]
use greeners::{OLS, CovarianceType};

// Estimates OLS with Newey-West HAC errors (Lags = 4)
let model = OLS::fit(&y, &x, CovarianceType::NeweyWest(4))?;
println!("Beta: {:.4}, StdErr: {:.4}", model.params[1], model.std_errors[1]);
\end{lstlisting}

\subsection{Instrumental Variables (2SLS)}
Used when regressors are endogenous ($E[\X\epsilon] \neq 0$). Instruments $\Z$ satisfy $E[\Z\epsilon] = 0$.
$$ \betahat_{IV} = (\hat{\X}'\hat{\X})^{-1}\hat{\X}'\y \quad \text{where} \quad \hat{\X} = \Z(\Z'\Z)^{-1}\Z'\X $$

\begin{lstlisting}[language=Rust]
use greeners::IV;
let model = IV::fit(&y, &x, &z, CovarianceType::HC1)?;
\end{lstlisting}

\section{2. Generalized Method of Moments (GMM)}

The estimator minimizes the quadratic distance of sample moments from zero.
Let $g_n(\bm{\beta}) = \frac{1}{n} \Z'(\y - \X\bm{\beta})$. The objective function is:
$$ J(\bm{\beta}) = n \cdot g_n(\bm{\beta})' \bm{W} g_n(\bm{\beta}) $$

\subsection{Two-Step Efficient GMM}
Greeners implements the optimal feasible GMM estimator:
\begin{enumerate}
    \item \textbf{Step 1:} Estimate consistent $\betahat_1$ using $\bm{W} = (\Z'\Z)^{-1}$ (2SLS).
    \item \textbf{Step 2:} Estimate the optimal weighting matrix $\hat{\bm{S}}$ (Hansen's Matrix) using Step 1 residuals:
    $$ \hat{\bm{S}} = \frac{1}{n} \sum_{i=1}^n \hat{\epsilon}_i^2 \bm{z}_i \bm{z}_i' $$
    \item \textbf{Step 3:} Minimize $J(\bm{\beta})$ using $\bm{W}_{opt} = \hat{\bm{S}}^{-1}$.
\end{enumerate}

\textbf{Rust Implementation:}
\begin{lstlisting}[language=Rust]
use greeners::GMM;
// Automatically performs the two-step procedure and computes Hansen's J
let res = GMM::fit(&y, &x, &z)?;
println!("J-Stat P-val: {:.4}", res.j_p_value);
\end{lstlisting}

\section{3. Discrete Choice Models (MLE)}

Estimates binary outcome models $P(y_i=1|\bm{x}_i) = F(\bm{x}_i'\bm{\beta})$ via Newton-Raphson optimization.
$$ \betahat_{new} = \betahat_{old} - \bm{H}^{-1} \nabla \mathcal{L} $$

\subsection{Logit vs. Probit}
\begin{itemize}
    \item \textbf{Logit:} $F(z) = \Lambda(z) = (1+e^{-z})^{-1}$. Hessian weighting matrix $\bm{W} = \text{diag}(p(1-p))$.
    \item \textbf{Probit:} $F(z) = \Phi(z)$ (Standard Normal). Hessian weighting relies on the ratio of PDF squared to CDF variance: $\frac{\phi^2}{\Phi(1-\Phi)}$.
\end{itemize}

\textbf{Rust Implementation:}
\begin{lstlisting}[language=Rust]
use greeners::{Logit, Probit};

let logit = Logit::fit(&y, &x)?;
let probit = Probit::fit(&y, &x)?; // Uses Normal CDF

println!("Logit Pseudo-R2: {:.4}", logit.pseudo_r2);
println!("Probit LogLikelihood: {:.4}", probit.log_likelihood);
\end{lstlisting}

\section{4. Causal Inference (DiD)}

Estimates the \textit{Average Treatment Effect on the Treated} (ATT) using the canonical $2 \times 2$ difference-in-differences design.

$$ y_{it} = \beta_0 + \beta_1 \text{Treat}_i + \beta_2 \text{Post}_t + \delta_{ATT} (\text{Treat}_i \times \text{Post}_t) + \epsilon_{it} $$

The estimator identifies the causal effect under the \textit{Parallel Trends Assumption}:
$$ \hat{\delta}_{ATT} = (\bar{y}_{T,Post} - \bar{y}_{T,Pre}) - (\bar{y}_{C,Post} - \bar{y}_{C,Pre}) $$

\textbf{Rust Implementation:}
\begin{lstlisting}[language=Rust]
use greeners::DiffInDiff;
// Automatically handles interaction terms and group means
let did = DiffInDiff::fit(&y, &treated_dummy, &post_dummy, CovarianceType::HC1)?;
println!("ATT Effect: {:.4}", did.att);
\end{lstlisting}

\section{5. Time Series Diagnostics}

\subsection{Augmented Dickey-Fuller (ADF)}
Tests the null hypothesis of a Unit Root ($H_0: \gamma = 0$) in the regression:
$$ \Delta y_t = \alpha + \gamma y_{t-1} + \sum_{j=1}^p \delta_j \Delta y_{t-j} + \epsilon_t $$
The t-statistic is compared against MacKinnon's critical values.

\textbf{Rust Implementation:}
\begin{lstlisting}[language=Rust]
use greeners::TimeSeries;
// Tests stationarity. Returns test-stat and critical values.
let adf = TimeSeries::adf(&series, None)?; 
if adf.is_stationary { println!("Series is I(0)"); }
\end{lstlisting}

\end{document}